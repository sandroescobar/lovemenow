<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} - LoveMeNow</title>
    <meta name="description" content="{{ product.description[:150] if product.description else 'Premium quality adult product from LoveMeNow' }}">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/styles.css') }}">
    
    <style>
        .product-detail-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        

        .product-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            margin-bottom: 4rem;
        }
        
        .product-images {
            position: sticky;
            top: 2rem;
            height: fit-content;
        }
        
        .main-image-container {
            position: relative;
            margin-bottom: 1rem;
            border-radius: var(--radius-lg);
            overflow: hidden;
            background: hsl(var(--surface-color));
        }
        
        .main-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .main-image:hover {
            transform: scale(1.05);
        }
        
        .image-thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-md);
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .thumbnail.active {
            border-color: hsl(var(--primary-color));
        }
        
        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .product-info {
            padding: 1rem 0;
        }
        
        .product-category {
            color: hsl(var(--primary-color));
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        
        .product-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .stars {
            display: flex;
            gap: 0.25rem;
        }
        
        .star {
            color: #ffd700;
        }
        
        .rating-text {
            color: hsl(var(--muted-color));
            font-size: 0.9rem;
        }
        
        .product-price {
            font-size: 2rem;
            font-weight: 700;
            color: hsl(var(--primary-color));
            margin-bottom: 2rem;
        }
        
        .stock-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .stock-status.in-stock {
            color: #28a745;
        }
        
        .stock-status.out-of-stock {
            color: #dc3545;
        }
        
        .product-colors {
            margin-bottom: 2rem;
        }
        
        .colors-label {
            font-weight: 600;
            margin-bottom: 1rem;
            display: block;
        }
        
        .color-options {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .color-option.active {
            border-color: hsl(var(--primary-color));
            transform: scale(1.1);
        }
        
        .color-option:hover {
            transform: scale(1.05);
        }
        
        .quantity-section {
            margin-bottom: 1rem;
        }
        
        .quantity-label {
            font-weight: 600;
            margin-bottom: 1rem;
            display: block;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .quantity-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }
        
        .quantity-input {
            width: 70px;
            height: 40px;
            text-align: center;
            background: hsl(var(--surface-color));
            border: 1px solid hsl(var(--border-color));
            border-radius: var(--radius-sm);
            color: hsl(var(--text-color));
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .quantity-input:focus {
            outline: none;
            border-color: hsl(var(--primary-color));
        }
        
        .quantity-buttons {
            display: flex;
            gap: 0.75rem;
        }
        
        .quantity-btn {
            width: 40px;
            height: 36px;
            border: none;
            background: hsl(var(--border-color));
            color: hsl(var(--text-color));
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .quantity-btn:hover {
            background: hsl(var(--primary-color));
            color: white;
        }
        
        .product-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 2rem 0 3rem 0;
            padding: 1.5rem;
            background: hsla(var(--dark-color), 0.2);
            border-radius: 16px;
            border: 1px solid hsla(var(--primary-color), 0.1);
            backdrop-filter: blur(10px);
        }
        
        .ButtonsInProductDetails {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .ButtonsInProductDetails .btn-wishlist {
            width: 60px;
            height: 60px;
            flex-shrink: 0;
        }
        
        .ButtonsInProductDetails .btn-wishlist svg {
            width: 24px;
            height: 24px;
        }
        
        .btn-add-to-cart {
            flex: 1;
            padding: 1.25rem 2rem;
            background: linear-gradient(135deg, hsl(var(--primary-color, 280 100% 70%)), hsl(var(--accent-color, 340 100% 70%)));
            color: white !important;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex !important;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px hsla(var(--primary-color, 280 100% 70%), 0.3);
            min-height: 60px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-add-to-cart:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px hsla(var(--primary-color, 280 100% 70%), 0.4);
        }
        
        /* Fallback styles if CSS variables don't load */
        .btn-add-to-cart {
            background: linear-gradient(135deg, #8b5cf6, #ec4899) !important;
        }
        
        .btn-add-to-cart:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        .btn-add-to-cart:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-add-to-cart-detail {
            width: 100%;
            padding: 0.9rem 0.8rem;
            background: linear-gradient(135deg, #8b5cf6, #ec4899) !important;
            color: white !important;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex !important;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
            min-height: 56px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-add-to-cart-detail::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-add-to-cart-detail:hover::before {
            left: 100%;
        }
        
        .btn-add-to-cart-detail:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        .btn-add-to-cart-detail:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            background: #6b7280 !important;
        }
        

        
        .product-description {
            margin-bottom: 3rem;
            margin-top: 0.5rem;
        }
        
        .description-tabs {
            display: flex;
            border-bottom: 2px solid hsl(var(--border-color));
            margin-bottom: 2rem;
        }
        
        .tab-btn {
            padding: 1rem 2rem;
            background: none;
            border: none;
            color: hsl(var(--muted-color));
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            color:white;
            font-weight: 700;
        }
        
        .tab-btn.active {
            color: hsl(var(--primary-color));
            border-bottom-color: hsl(var(--primary-color));
        }
        
        .tab-content {
            display: none;
            line-height: 1.6;
            color: white;
            font-weight: 600;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .related-products {
            margin-top: 4rem;
        }
        
        .related-products h2 {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2rem;
            background: linear-gradient(135deg, hsl(var(--primary-color)), hsl(var(--accent-color)));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }
        
        @media (max-width: 768px) {
            .product-detail-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .product-images {
                position: static;
            }
            
            .main-image {
                height: 400px;
            }
            
            .product-title {
                font-size: 2rem;
            }
            
            .product-actions {
                flex-direction: column;
                padding: 1rem;
                gap: 0.75rem;
            }
            
            .btn-add-to-cart-detail {
                font-size: 1rem;
                min-height: 52px;
            }
            
            .ButtonsInProductDetails .btn-wishlist {
                width: 52px;
                height: 52px;
            }
            
            .quantity-controls {
                justify-content: center;
            }
            
            .quantity-input-group {
                gap: 0.5rem;
            }
            
            .quantity-input {
                width: 60px;
                height: 36px;
                font-size: 1rem;
            }
            
            .quantity-buttons {
                gap: 0.5rem;
            }
            
            .quantity-btn {
                width: 36px;
                height: 32px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <a class="navbar-brand" href="{{url_for('main.index')}}">
                <svg class="logo-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                </svg>
                LoveMeNow
            </a>

            <div class="navbar-center">
                <ul class="nav-links">
                    <li><a class="nav-link" href="{{url_for('main.index')}}">Home</a></li>
                    <li><a class="nav-link" href="{{url_for('main.products')}}">Shop</a></li>
                    <li><a class="nav-link" href="{{url_for('main.about')}}">About</a></li>
                    <li><a class="nav-link" href="{{url_for('main.support')}}">Support</a></li>
                </ul>
            </div>

            <div class="navbar-actions">
                <div class="nav-buttons">
                    <button type="button" onclick="openWishlistModal()" class="nav-icon-btn" title="Wishlist">
                        <i class="fas fa-heart"></i>
                        <span class="icon-badge" id="wishlistCount">0</span>
                    </button>
                    <a href="{{ url_for('main.cart_page') }}" class="nav-icon-btn" title="Cart">
                        <i class="fas fa-shopping-bag"></i>
                        <span class="icon-badge" id="cartCount" style="display: inline-block;">0</span>
                    </a>
                    {% if current_user.is_authenticated %}
                        <button class="btn btn-primary" id="userMenuButton">Account</button>
                    {% else %}
                        <button class="btn btn-primary" id="signInButton">Sign In</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <div class="product-detail-container">
        <div class="product-detail-grid">
            <!-- Product Images -->
            <div class="product-images">
                <div class="main-image-container">
                    {% set all_images = [] %}
                    {% if product.image_url %}
                        {% set _ = all_images.append(product.image_url) %}
                    {% endif %}
                    {% for img in product.images %}
                        {% if img.url not in all_images %}
                            {% set _ = all_images.append(img.url) %}
                        {% endif %}
                    {% endfor %}
                    
                    {% if all_images %}
                        <img id="mainImage" class="main-image" 
                             src="{{ all_images[0] if all_images[0].startswith('http') else url_for('static', filename=all_images[0].lstrip('/')) }}" 
                             alt="{{ product.name|e }}">
                    {% else %}
                        <div class="main-image" style="display: flex; align-items: center; justify-content: center; background: hsl(var(--surface-color)); color: hsl(var(--muted-color));">
                            <i class="fas fa-image" style="font-size: 4rem;"></i>
                        </div>
                    {% endif %}
                </div>
                
                {% if all_images|length > 1 %}
                <div class="image-thumbnails">
                    {% for image_url in all_images %}
                    <div class="thumbnail {{ 'active' if loop.first else '' }}" onclick="changeMainImage('{{ image_url if image_url.startswith('http') else url_for('static', filename=image_url.lstrip('/')) }}', this)">
                        <img src="{{ image_url if image_url.startswith('http') else url_for('static', filename=image_url.lstrip('/')) }}" alt="Product image {{ loop.index }}">
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Product Info -->
            <div class="product-info">
                {% if product.category %}
                <div class="product-category">{{ product.category.name }}</div>
                {% endif %}
                
                <h1 class="product-title">{{ product.name }}</h1>
                
                <div class="product-rating">
                    <div class="stars">
                        {% for i in range(5) %}
                            {% if i < (product.rating or 0)|int %}
                                <i class="fas fa-star star"></i>
                            {% else %}
                                <i class="far fa-star star"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <span class="rating-text">({{ product.review_count or 0 }} reviews)</span>
                </div>
                
                <div class="product-price">${{ '%.2f'|format(product.price) }}</div>
                
                <div class="stock-status {{ 'in-stock' if product.in_stock else 'out-of-stock' }}">
                    <i class="fas fa-{{ 'check-circle' if product.in_stock else 'times-circle' }}"></i>
                    <span>{{ 'In Stock' if product.in_stock else 'Out of Stock' }}</span>
                    {% if product.quantity_on_hand and product.in_stock %}
                        <span>({{ product.quantity_on_hand }} available)</span>
                    {% endif %}
                </div>
                
                {% if product.colors %}
                <div class="product-colors">
                    <span class="colors-label">Available Colors:</span>
                    <div class="color-options">
                        {% for color in product.colors %}
                        <div class="color-option {{ 'active' if loop.first else '' }}" 
                             style="background-color: {{ color.hex }};" 
                             title="{{ color.name }}"
                             onclick="selectColor(this, '{{ color.name }}')"></div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <div class="quantity-section">
                    <span class="quantity-label">Quantity:</span>
                    <div class="quantity-controls">
                        <div class="quantity-input-group">
                            <input type="number" id="quantityInput" class="quantity-input" value="1" min="1" max="{{ product.quantity_on_hand or 99 }}">
                            <div class="quantity-buttons">
                                <button class="quantity-btn" onclick="changeQuantity(-1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button class="quantity-btn" onclick="changeQuantity(1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Add to Cart button moved under quantity -->

                </div>

                <div class="ButtonsInProductDetails">
                    <button class="btn-add-to-cart-detail"
                            data-product-id="{{ product.id }}" 
                            data-product-name="{{ product.name|e }}" 
                            data-product-price="{{ product.price }}" 
                            data-quantity-on-hand="{{ product.quantity_on_hand or 0 }}"
                            {% if not product.in_stock or (product.quantity_on_hand and product.quantity_on_hand <= 0) %}disabled{% endif %}
                            id="addToCartBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span>{{ 'Add to Cart' if product.in_stock else 'Out of Stock' }}</span>
                    </button>

                    <button class="btn-wishlist" onclick="toggleWishlist({{ product.id }}, '{{ product.name|e }}', this)" data-product-id="{{ product.id }}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                    </button>
                </div>

                <div class="product-description">
                    <div class="description-tabs">
                        <button class="tab-btn active" onclick="showTab('description')">Description</button>
                        {% if product.specifications %}
                        <button class="tab-btn" onclick="showTab('specifications')">Specifications</button>
                        {% endif %}
                        {% if product.dimensions %}
                        <button class="tab-btn" onclick="showTab('dimensions')">Dimensions</button>
                        {% endif %}
                    </div>
                    
                    <div id="description" class="tab-content active">
                        <p>{{ product.description or 'Premium quality product designed for your intimate moments. Crafted with care and attention to detail.' }}</p>
                    </div>
                    
                    {% if product.specifications %}
                    <div id="specifications" class="tab-content">
                        <p>{{ product.specifications }}</p>
                    </div>
                    {% endif %}
                    
                    {% if product.dimensions %}
                    <div id="dimensions" class="tab-content">
                        <p>{{ product.dimensions }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Related Products -->
        {% if related_products %}
        <div class="related-products">
            <h2>You Might Also Like</h2>
            <div class="related-grid">
                {% for related_product in related_products %}
                <div class="product-card fade-in-up">
                    <div class="product-image">
                        {% set related_images = [] %}
                        {% if related_product.image_url %}
                            {% set _ = related_images.append(related_product.image_url) %}
                        {% endif %}
                        {% for img in related_product.images %}
                            {% if img.url not in related_images %}
                                {% set _ = related_images.append(img.url) %}
                            {% endif %}
                        {% endfor %}

                        {% if related_images %}
                            <img style="width: 100%; height: 250px; object-fit: cover;"
                                 src="{{ related_images[0] if related_images[0].startswith('http') else url_for('static', filename=related_images[0].lstrip('/')) }}"
                                 alt="{{ related_product.name|e }}" loading="lazy">
                        {% else %}
                            <div class="placeholder-image">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="9" cy="9" r="2"></circle>
                                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                                </svg>
                            </div>
                        {% endif %}
                        <div class="product-actions">
                            <button class="btn-quick-view" onclick="openQuickView({{ related_product.id }})">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-category">{{ related_product.category.name if related_product.category else 'Featured' }}</div>
                        <h3 class="product-title">
                            <a href="/product/{{ related_product.id }}">{{ related_product.name }}</a>
                        </h3>
                        <div class="product-price">${{ '%.2f'|format(related_product.price) }}</div>
                        <div class="product-buttons">
                            <button class="btn-add-cart" onclick='addToCart({{ related_product.id }}, {{ related_product.name|tojson }}, {{ related_product.price }})'>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                </svg>
                                Add to Cart
                            </button>
                            <button class="btn-wishlist" onclick="toggleWishlist({{ related_product.id }}, '{{ related_product.name|e }}', this)" data-product-id="{{ related_product.id }}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Include modals -->
    {% include 'login_modal.html' %}
    {% include 'register_modal.html' %}
    {% include 'logged_in_modal.html' %}
    {% include 'wishlist_modal.html' %}
    {% include 'cart_modal.html' %}
    {% include 'quick_view_modal.html' %}

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    
    <script>
        let selectedQuantity = 1;
        let selectedColor = null;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 Product detail page loaded');
            
            // Check if functions are available
            console.log('updateCartCount available:', typeof updateCartCount);
            console.log('updateWishlistCount available:', typeof updateWishlistCount);
            console.log('toggleWishlist available:', typeof toggleWishlist);
            
            updateCartCount();
            
            // Get initial wishlist count
            fetch('/api/wishlist')
            .then(response => response.json())
            .then(data => {
                console.log('Initial wishlist data:', data);
                updateWishlistCount(data.count || 0);
            })
            .catch(error => {
                console.error('Error getting wishlist count:', error);
                updateWishlistCount(0); // Fallback to 0 on error
            });
            
            console.log('Checking wishlist status for product ID:', {{ product.id }});
            // Check wishlist status for the detail page button
            const wishlistBtn = document.querySelector('.btn-wishlist[data-product-id="{{ product.id }}"]');
            if (wishlistBtn) {
                checkWishlistStatus({{ product.id }}, wishlistBtn);
            }
            
            // Set initial color selection
            const firstColor = document.querySelector('.color-option.active');
            if (firstColor) {
                selectedColor = firstColor.getAttribute('title');
            }
            
            // Check if add to cart button exists
            const addToCartBtn = document.getElementById('addToCartBtn');
            console.log('🛒 Add to cart button found:', addToCartBtn);
            
            if (addToCartBtn) {
                console.log('✅ Add to cart button is visible and ready');
            } else {
                console.error('❌ Add to cart button not found!');
            }
            
            // Check if wishlist button exists
            const wishlistBtnDebug = document.querySelector('.btn-wishlist[data-product-id="{{ product.id }}"]');
            console.log('🔍 Wishlist button found:', wishlistBtnDebug);
            if (wishlistBtnDebug) {
                console.log('✅ Wishlist button is visible and ready');
            } else {
                console.error('❌ Wishlist button not found!');
            }
        });

        function changeMainImage(imageSrc, thumbnail) {
            document.getElementById('mainImage').src = imageSrc;
            
            // Update active thumbnail
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
            thumbnail.classList.add('active');
        }

        function selectColor(colorElement, colorName) {
            document.querySelectorAll('.color-option').forEach(c => c.classList.remove('active'));
            colorElement.classList.add('active');
            selectedColor = colorName;
        }

        function changeQuantity(delta) {
            const input = document.getElementById('quantityInput');
            const newValue = parseInt(input.value) + delta;
            const max = parseInt(input.getAttribute('max'));
            
            if (newValue >= 1 && newValue <= max) {
                input.value = newValue;
                selectedQuantity = newValue;
            }
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        window.addToCartDetail = function addToCartDetail(productId, productName, price) {
            console.log('🛒 Add to cart clicked:', productId, productName, price);
            
            const quantityInput = document.getElementById('quantityInput');
            const quantity = quantityInput ? parseInt(quantityInput.value) : 1;
            const addToCartBtn = document.getElementById('addToCartBtn');
            
            // Disable button temporarily
            if (addToCartBtn) {
                addToCartBtn.disabled = true;
                addToCartBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Adding...</span>';
            }
            
            fetch('/api/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_id: productId,
                    quantity: quantity
                })
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.message) {
                    updateCartCount();
                    // Silent add to cart - no toast message
                } else if (data.error) {
                    showToast(data.error, 'error');
                }
            })
            .catch(error => {
                console.error('Error adding to cart:', error);
                showToast('Error adding to cart', 'error');
            })
            .finally(() => {
                // Re-enable button
                if (addToCartBtn) {
                    addToCartBtn.disabled = false;
                    addToCartBtn.innerHTML = '<i class="fas fa-shopping-cart"></i><span>Add to Cart</span>';
                }
            });
        }




    </script>
</body>
</html>
