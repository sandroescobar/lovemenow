<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="LoveMeNow - Premium quality adult products for your intimate moments" />
  <title>LoveMeNow - Premium Adult Products</title>
  <link rel="canonical" href="{{ url_for('main.index', _external=True) }}" />

  <!-- Critical CSS - Inline for immediate rendering -->
  <style>
    /* Inline critical CSS for above-the-fold content */
    *{margin:0;padding:0;box-sizing:border-box}:root{--primary-color:339 100% 50%;--accent-color:328 85% 46%;--background-color:0 0% 100%;--surface-color:0 0% 98%;--text-color:240 10% 3.9%;--muted-color:240 3.8% 46%;--border-color:240 5.9% 90%;--radius-sm:0.25rem;--radius-md:0.5rem;--radius-lg:0.75rem;--shadow-sm:0 1px 2px rgba(0,0,0,0.05);--shadow-md:0 4px 6px rgba(0,0,0,0.07);--shadow-lg:0 10px 15px rgba(0,0,0,0.1)}body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;color:hsl(var(--text-color));background:hsl(var(--background-color));line-height:1.5;-webkit-font-smoothing:antialiased}.navbar{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-bottom:1px solid hsl(var(--border-color));height:64px}.navbar-container{max-width:1280px;margin:0 auto;padding:0 1rem;display:flex;align-items:center;justify-content:space-between;height:100%}.navbar-brand{display:flex;align-items:center;gap:0.5rem;font-size:1.25rem;font-weight:700;color:hsl(var(--text-color));text-decoration:none}.nav-links{display:flex;gap:2rem;list-style:none}.nav-link{color:hsl(var(--text-color));text-decoration:none;font-weight:500}.navbar-actions{display:flex;gap:1rem;align-items:center}.nav-icon-btn{position:relative;background:transparent;border:none;color:hsl(var(--text-color));cursor:pointer;padding:0.5rem;font-size:1.25rem}.icon-badge{position:absolute;top:-4px;right:-4px;background:hsl(var(--primary-color));color:white;border-radius:50%;width:18px;height:18px;font-size:0.75rem;display:flex;align-items:center;justify-content:center;font-weight:600}.hero{min-height:60vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,hsl(var(--primary-color) / 0.1),hsl(var(--accent-color) / 0.1));margin-top:64px;padding:4rem 1rem;text-align:center}.hero-content{max-width:800px}.hero h1{font-size:clamp(2rem,5vw,3.5rem);font-weight:800;margin-bottom:1rem;background:linear-gradient(135deg,hsl(var(--primary-color)),hsl(var(--accent-color)));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.lead{font-size:1.25rem;color:hsl(var(--muted-color));margin-bottom:2rem}.btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.75rem 1.5rem;border-radius:var(--radius-md);font-weight:600;text-decoration:none;cursor:pointer;transition:all 0.2s;border:none}.btn-primary{background:hsl(var(--primary-color));color:white}.btn-lg{padding:1rem 2rem;font-size:1.125rem}.container{max-width:1280px;margin:0 auto;padding:0 1rem}.product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:2rem;padding:2rem 0}.product-card{background:hsl(var(--surface-color));border-radius:var(--radius-lg);overflow:hidden}.product-image{aspect-ratio:1/1;background:hsl(var(--surface-color));position:relative;overflow:hidden}@media (max-width:768px){.nav-links,.navbar-center{display:none}.hero{min-height:50vh;padding:3rem 1rem}.product-grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem}}img{display:block;max-width:100%;height:auto}
    
    /* Toast styles inline to prevent layout shift */
    .toast-stack{position:fixed;top:2rem;right:2rem;z-index:99999;display:flex;flex-direction:column;gap:.5rem}.toast{color:#fff;border:none;border-radius:8px;padding:1rem 1.5rem;min-width:300px;position:relative;font-size:1rem;font-weight:600;animation:toastSlideInRight .3s ease both;box-shadow:0 4px 12px rgba(0,0,0,.25)}
  </style>

  <!-- Preload critical resources -->
  <link rel="preload" href="{{ url_for('static', filename='CSS/styles.css') }}" as="style">
  <link rel="preload" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2" as="font" type="font/woff2" crossorigin>
  
  <!-- DNS Prefetch for external resources -->
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  
  <!-- Icons / Favicon -->
  <link rel="icon" href="{{ url_for('static', filename='IMG/icons/favicon.ico') }}" type="image/x-icon">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='IMG/icons/apple-touch-icon.png') }}">
  
  <!-- Load main CSS asynchronously -->
  <link rel="preload" href="{{ url_for('static', filename='CSS/styles.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ url_for('static', filename='CSS/styles.css') }}"></noscript>
  
  <!-- Load other CSS files asynchronously -->
  <link rel="preload" href="{{ url_for('static', filename='CSS/performance.css') }}?v=20250116-3" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="{{ url_for('static', filename='CSS/mobile-optimizations.css') }}?v=20250116-3" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
  <!-- Font Awesome - Load async -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
  <!-- CSRF Meta -->
  {% include 'csrf_meta.html' %}
  
</head>
<body>
  {% include 'google_tag_body.html' %}
  <!-- NAV -->
  {% include "navbar.html" %}

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content fade-in-up">
      <h1>Elevate Your Intimate Moments</h1>
      <p class="lead">Discover premium quality products designed to enhance your personal experiences with discreet service and fast delivery.</p>
      <a href="/products" class="btn btn-primary btn-lg">Explore Now</a>
    </div>
  </section>

  <!-- Miami Service Section - Lazy load map -->
  <section class="miami-service-section">
    <div class="container">
      <div class="miami-content">
        <div class="miami-info">
          <div class="service-badge"><i class="fas fa-map-marker-alt"></i><span>Miami Exclusive</span></div>
          <h2>Premium Service Across the Magic City</h2>
          <p class="miami-description">Experience unparalleled convenience with our discreet delivery and pickup services covering all of Miami-Dade County.</p>

          <div class="service-features">
            <div class="service-feature"><div class="feature-icon"><i class="fas fa-truck"></i></div><div class="feature-content"><h3>Same-Day Delivery</h3><p>Order before 2 PM for same-day delivery across Miami</p></div></div>
            <div class="service-feature"><div class="feature-icon"><i class="fas fa-store"></i></div><div class="feature-content"><h3>Discreet Pickup Points</h3><p>Brickell, Wynwood & Coral Gables</p></div></div>
            <div class="service-feature"><div class="feature-icon"><i class="fas fa-clock"></i></div><div class="feature-content"><h3>24/7 Service</h3><p>Round-the-clock availability</p></div></div>
          </div>

          <div class="miami-cta">
            <a href="/products" class="btn btn-primary btn-lg"><i class="fas fa-shopping-bag"></i> Shop Miami Collection</a>
            <a href="#coverage-map" class="btn-coverage-link"><i class="fas fa-map"></i> View Coverage Areas</a>
          </div>
        </div>

        <div class="miami-visual">
          <div class="miami-map-container" id="map-container">
            <!-- Lazy load iframe -->
            <iframe 
              data-src="/miami-map" 
              class="folium-map lazy-iframe" 
              frameborder="0" 
              title="Miami Coverage Map"
              loading="lazy">
            </iframe>
            <div class="coverage-stats">
              <div class="stat-item"><div class="stat-number">100+</div><div class="stat-label">Areas Covered</div></div>
              <div class="stat-item"><div class="stat-number">1 Hour</div><div class="stat-label">Avg Delivery</div></div>
              <div class="stat-item"><div class="stat-number">10AM-10PM</div><div class="stat-label">Mon-Sun</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Products with optimized image loading -->
  <section class="container" style="padding:4rem 1rem;">
    <div class="text-center mb-4">
      <h2 style="font-size:2.5rem;margin-bottom:1rem;background:linear-gradient(135deg,hsl(var(--primary-color)),hsl(var(--accent-color)));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Featured Products</h2>
      <p style="font-size:1.125rem;opacity:.8;max-width:600px;margin:0 auto;">Carefully curated selection of our most popular intimate products</p>
    </div>

    <div class="product-grid">
      {% for product in featured_products %}
      <div class="product-card fade-in-up" data-product-id="{{ product.id }}" data-in-stock="{{ product.in_stock|lower }}" data-product-quantity="{{ product.quantity_on_hand or 0 }}">
        <div class="product-image product-card-slideshow" data-product-id="{{ product.id }}">
          {% set all_images = product.all_image_urls %}
          {% if product.image_url and product.image_url not in all_images %}{% set _ = all_images.append(product.image_url) %}{% endif %}
          {% if all_images %}
            {% for image_url in all_images %}
            <img class="product-slide {{ 'active' if loop.first else '' }}"
                 src="{{ image_url if image_url.startswith('http') or image_url.startswith('/static/') else url_for('static', filename=image_url.lstrip('/')) }}"
                 alt="{{ product.name|e }}" 
                 loading="{{ 'eager' if loop.first and loop.index0 < 3 else 'lazy' }}"
                 fetchpriority="{{ 'high' if loop.first and loop.index0 < 3 else 'auto' }}"
                 decoding="async"
                 style="width:100%;height:240px;object-fit:contain;background:rgba(255,255,255,0.02);" 
                 onerror="handleImageError(this)">
            {% endfor %}
            {% if all_images|length > 1 %}
              <button class="product-card-nav-arrow prev" onclick="navigateProductCardImage({{ product.id }},-1)" aria-label="Previous image"><i class="fas fa-chevron-left"></i></button>
              <button class="product-card-nav-arrow next" onclick="navigateProductCardImage({{ product.id }}, 1)" aria-label="Next image"><i class="fas fa-chevron-right"></i></button>
              <div class="product-card-image-counter"><span class="current-image">1</span> / <span class="total-images">{{ all_images|length }}</span></div>
            {% endif %}
          {% else %}
            <div class="placeholder-image"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg></div>
          {% endif %}
          <div class="product-actions"><button class="btn-quick-view" onclick="openQuickView({{ product.id }})"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div>
        </div>
        <div class="product-info">
          <div class="product-category">{{ product.category.name if product.category else 'Featured' }}</div>
          <h3 class="product-title"><a href="/product/{{ product.id }}">{{ product.clean_name }}</a></h3>
          {% set fake_original = (product.price / 0.85)|round(2) %}
          <div class="product-price">
            <span class="price-was">${{ '%.2f'|format(fake_original) }}</span>
            <span class="price-now">${{ '%.2f'|format(product.price) }}</span>
            <span class="price-badge">SALE</span>
          </div>
          <div class="product-buttons">
            <button class="btn-add-cart" data-product-id="{{ product.id }}" data-variant-id="{{ product.default_variant.id if product.default_variant else '' }}" data-product-name="{{ product.name|e }}" data-product-price="{{ product.price }}" data-quantity-on-hand="{{ product.quantity_on_hand or 0 }}" {% if not product.is_available %}disabled{% endif %}>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
              {{ 'Add to Cart' if product.is_available else 'Out of Stock' }}
            </button>
            <button class="btn-wishlist" data-product-id="{{ product.id }}" data-product-name="{{ product.name|e }}">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            </button>
          </div>
        </div>
      </div>
      {% endfor %}

      {% if not featured_products %}
      <div style="grid-column:1/-1;text-align:center;padding:2rem;"><p style="color:hsl(var(--muted-color));">No products available at the moment.</p></div>
      {% endif %}
    </div>

    <div class="text-center mt-4"><a href="/products" class="btn btn-primary btn-lg">View All Products</a></div>
  </section>

  <!-- Modals - Load lazy -->
  <div id="modal-container"></div>

  <!-- FOOTER -->
  {% include "footer.html" %}

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="toast-stack" id="flashStack" role="status" aria-live="polite">
        {% for category, msg in messages %}
          <div class="toast toast-{{ category }}">
            <button class="flash_message_close" aria-label="Close notification" onclick="this.parentElement.remove()">
              <i class="fas fa-times" aria-hidden="true"></i>
            </button>
            {{ msg }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Google Ads Tag -->
  {% include 'google_tag_head.html' %}

  <!-- Load modals asynchronously -->
  <script>
    // Lazy load modals and iframes
    window.addEventListener('DOMContentLoaded', function() {
      // Load modal HTML content from existing templates
      const modalContainer = document.getElementById('modal-container');
      if (modalContainer) {
        // Instead of fetching from a file, we'll include the templates but hidden
        modalContainer.style.display = 'none';
      }
      
      // Lazy load iframe
      const lazyIframes = document.querySelectorAll('.lazy-iframe');
      lazyIframes.forEach(iframe => {
        if (iframe.dataset.src) {
          iframe.src = iframe.dataset.src;
        }
      });
    });
  </script>
  
  <!-- Include actual modal templates but hidden initially -->
  <div id="modal-container" style="display:none;">
    {% include "wishlist_modal.html" %}
    {% include "cart_modal.html" %}
    {% include "login_register_modal.html" %}
    {% include "logged_in_modal.html" %}
  </div>

  <!-- Promo Modal (if age verified) -->
  {% if age_verified %}
  {% include "promo_modal.html" %}
  <script src="{{ url_for('static', filename='js/promo_modal.js') }}?v=20251002-5" defer></script>
  {% endif %}

  <!-- JS Loading - Use existing scripts but defer them -->
  <script src="{{ url_for('static', filename='js/csrf-handler.js') }}?v=20250116-2" defer></script>
  <script src="{{ url_for('static', filename='js/toast.js') }}?v=20250116-2" defer></script>
  <script src="{{ url_for('static', filename='js/mobile-menu.js') }}?v=20250116-2" defer></script>
  <script src="{{ url_for('static', filename='js/index.js') }}?v=20250116-2" defer></script>
  <script src="{{ url_for('static', filename='js/home.js') }}?v=20250116-2" defer></script>
  <script src="{{ url_for('static', filename='js/discount.js') }}?v=20251001-4" defer></script>
</body>
</html>