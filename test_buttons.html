<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Button Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: #1a1a1a;
            color: white;
        }
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 2rem;
            background: #2a2a2a;
            border-radius: 12px;
        }
        .product-buttons {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }
        .btn-add-cart {
            flex: 1;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-add-cart:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        .btn-wishlist {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ccc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .btn-wishlist:hover {
            color: #ef4444;
            border-color: #ef4444;
        }
        .btn-wishlist.liked {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }
        .toast.info { background: #3b82f6; }
        .toast.show { transform: translateX(0); }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>Button Functionality Test</h2>
        <p>Testing add to cart and wishlist buttons</p>
        
        <div class="product-buttons">
            <button class="btn-add-cart" 
                    data-product-id="2"
                    data-product-name="Test Product"
                    data-product-price="29.99"
                    data-quantity-on-hand="1">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                Add to Cart
            </button>
            <button class="btn-wishlist" data-product-id="2" data-product-name="Test Product">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                </svg>
            </button>
        </div>
        
        <div id="status"></div>
    </div>

    <script>
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Set up event delegation like the main site
        document.addEventListener('click', function(e) {
            if (e.target.closest('.btn-add-cart')) {
                e.preventDefault();
                const button = e.target.closest('.btn-add-cart');
                const productId = parseInt(button.dataset.productId);
                const productName = button.dataset.productName;
                const productPrice = parseFloat(button.dataset.productPrice);
                
                testAddToCart(productId, productName, productPrice, button);
            }
            
            if (e.target.closest('.btn-wishlist')) {
                e.preventDefault();
                const button = e.target.closest('.btn-wishlist');
                const productId = parseInt(button.dataset.productId);
                const productName = button.dataset.productName;
                
                testToggleWishlist(productId, productName, button);
            }
        });

        function testAddToCart(productId, productName, price, button) {
            const originalContent = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<svg class="animate-spin" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"></circle></svg> Adding...';
            
            fetch('http://127.0.0.1:8900/api/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_id: productId,
                    quantity: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    showToast('Added to cart!', 'success');
                    document.getElementById('status').innerHTML = `<p style="color: #10b981;">‚úÖ Cart: ${data.message} (Count: ${data.count})</p>`;
                } else if (data.error) {
                    showToast(data.error, 'error');
                    document.getElementById('status').innerHTML = `<p style="color: #ef4444;">‚ùå Error: ${data.error}</p>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Error adding to cart', 'error');
                document.getElementById('status').innerHTML = `<p style="color: #ef4444;">‚ùå Network Error: ${error.message}</p>`;
            })
            .finally(() => {
                button.disabled = false;
                button.innerHTML = originalContent;
            });
        }

        function testToggleWishlist(productId, productName, buttonElement) {
            const isLiked = buttonElement.classList.contains('liked');
            const originalContent = buttonElement.innerHTML;
            buttonElement.disabled = true;
            buttonElement.innerHTML = '<svg class="animate-spin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"></circle></svg>';
            
            const endpoint = isLiked ? 'remove' : 'add';
            
            fetch(`http://127.0.0.1:8900/api/wishlist/${endpoint}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ product_id: productId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    if (isLiked) {
                        buttonElement.classList.remove('liked');
                        showToast('Removed from wishlist', 'info');
                        document.getElementById('status').innerHTML = `<p style="color: #3b82f6;">üíô Wishlist: Removed (Count: ${data.count})</p>`;
                    } else {
                        buttonElement.classList.add('liked');
                        showToast('Added to wishlist!', 'success');
                        document.getElementById('status').innerHTML = `<p style="color: #10b981;">‚ù§Ô∏è Wishlist: Added (Count: ${data.count})</p>`;
                    }
                } else if (data.error) {
                    showToast(data.error, 'error');
                    document.getElementById('status').innerHTML = `<p style="color: #ef4444;">‚ùå Error: ${data.error}</p>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Error with wishlist', 'error');
                document.getElementById('status').innerHTML = `<p style="color: #ef4444;">‚ùå Network Error: ${error.message}</p>`;
            })
            .finally(() => {
                buttonElement.disabled = false;
                buttonElement.innerHTML = originalContent;
            });
        }
    </script>
</body>
</html>